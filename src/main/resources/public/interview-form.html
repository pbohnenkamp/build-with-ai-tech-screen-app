<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interview Form - Tech Screen App</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      /* Print styles */
      @media print {
        @page {
          margin: 0.25in; /* Minimum reliable margin for most printers */
          size: letter portrait;
        }

        body {
          font-size: 11px; /* Smaller font for print */
          margin: 0; /* Remove body margin in print */
          padding: 0; /* Remove body padding in print */
        }

        .no-print {
          display: none !important;
        }

        .page-break {
          page-break-after: always;
        }

        .question {
          page-break-inside: avoid;
        }

        .technology-section {
          break-inside: avoid;
        }

        .candidate-info {
          display: flex;
          flex-wrap: nowrap;
          justify-content: space-between;
          font-size: 10px;
        }
      }

      /* Screen styles */
      body {
        max-width: 8.5in;
        margin: 0 auto;
        padding: 10px; /* Reduced from 20px */
      }

      .header {
        /* margin-bottom: 20px; removed */
      }

      .candidate-info {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 15px;
        font-size: 0.9em;
      }

      .info-item {
        display: flex;
        align-items: center;
        gap: 5px;
        white-space: nowrap;
      }

      .notes-area {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 2px;
        height: 80px;
        margin-bottom: 4px;
      }

      .notes-label {
        font-style: italic;
        color: #666;
      }

      #technologiesContainer {
        column-count: 2;
        column-gap: 30px;
        column-fill: balance;
      }

      .technology-section {
        margin-bottom: 4px;
        break-inside: avoid;
        page-break-inside: avoid;
        display: inline-block;
        width: 100%;
      }

      .technology-name {
        font-weight: bold;
        font-size: 0.9em;
        margin-bottom: 3px;
        border-bottom: 1px solid #333;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .question {
        margin: 4px 0 4px 12px;
        font-size: 0.85em;
        line-height: 1.3;
      }

      .question-text {
        position: relative;
      }

      .question-text:before {
        content: "â€¢";
        position: absolute;
        left: -10px;
      }

      .print-button {
        margin-left: 10px;
      }

      @media screen {
        body {
          background: #f5f5f5;
        }

        .questionnaire {
          background: white;
          padding: 0.25in; /* Reduced from 0.5in to match print margins */
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
          min-height: 11in;
          box-sizing: border-box;
        }
      }
    </style>
  </head>
  <body>
    <div class="questionnaire">
      <div class="header">
        <div class="d-flex justify-content-between align-items-center mb-4 no-print">
          <nav class="no-print">
            <a href="/index.html" class="btn btn-outline-primary">Back to Tech Screens</a>
          </nav>
          <button class="btn btn-primary print-button no-print" onclick="window.print()">
            Print Form
          </button>
        </div>
        <div class="candidate-info">
          <div class="info-item">
            <strong>Candidate:</strong>
            <span id="candidateName"></span>
          </div>
          <div class="info-item">
            <strong>Client:</strong>
            <span id="clientName"></span>
          </div>
          <div class="info-item">
            <strong>Role:</strong>
            <span id="roleName"></span>
          </div>
          <div class="info-item">
            <strong>Date:</strong>
            <span id="screenDateTime"></span>
          </div>
        </div>

        <div class="notes-area">
          <div class="notes-label">Current Role Notes:</div>
        </div>

        <div id="technologiesContainer">
          <!-- Technology sections will be added here directly -->
        </div>
      </div>
    </div>

    <!-- Bootstrap JavaScript Bundle (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Get tech screen ID from URL
      const urlParams = new URLSearchParams(window.location.search);
      const techScreenId = urlParams.get("id");

      if (!techScreenId) {
        window.location.href = "/";
      }

      // Create a technology section
      function createTechnologySection(tech, questions) {
        const techSection = $(`
                            <div class="technology-section">
                                <div class="technology-name">${tech}</div>
                                <div class="questions"></div>
                            </div>
                        `);

        const questionsContainer = techSection.find(".questions");
        questions.forEach((question) => {
          questionsContainer.append(`
                                <div class="question">
                                    <div class="question-text">${question}</div>
                                </div>
                            `);
        });

        return techSection;
      }

      // Load tech screen data
      async function loadTechScreen() {
        try {
          const response = await fetch(`/api/tech-screens/${techScreenId}`);
          if (!response.ok) throw new Error("Failed to fetch tech screen");

          const techScreen = await response.json();

          // Update header info
          document.getElementById("candidateName").textContent =
            techScreen.candidateName;
          document.getElementById("clientName").textContent = techScreen.client;
          document.getElementById("roleName").textContent = techScreen.role;
          document.getElementById(
            "screenDateTime"
          ).textContent = `${techScreen.screenDate} ${techScreen.screenTime}`;

          // Create two columns
          const container = $("#technologiesContainer");
          const technologies = techScreen.technologies || [];
          const questions = techScreen.questions || {};

          // Distribute technologies vertically
          technologies.forEach((tech, index) => {
            const techQuestions = questions?.[tech] || [];
            const section = createTechnologySection(tech, techQuestions);
            container.append(section);
          });
        } catch (error) {
          console.error("Error loading tech screen:", error);
        }
      }

      // Load data when page loads
      document.addEventListener("DOMContentLoaded", loadTechScreen);
    </script>
  </body>
</html>
